/*!
 * jQuery modal popup form plugin.
 * Date: Nov 7, 2012.
 * Dependency: jQuery v1.8.3 or higher.
 * Source: https://github.com/rodrigocfd/jquery-modalForm
 *
 * Copyright (c) 2012 Rodrigo Cesar de Freitas Dias
 * Released under the MIT license, see license.txt for details.
 */
(function(a){var c={labelOk:"OK",labelCancel:"Cancel",background:"#FFF",bottomLine:"1px solid #E4E4E4",borderRadius:0,shadow:"3px 3px 28px #333",titleBackground:"#E2E2E2",titleColor:"",titleIcon:"",coverColor:"#000",coverOpacity:0.42,closeOnEsc:true,closeOnOutsideClick:true,disableF5:true};a.extend({modalForm:function(d){a.extend(c,d)}});a.fn.modalForm=function b(p){var l=a.extend({background:"",bottomLine:"",hasCancel:false,event:null,title:"",titleBackground:"",titleColor:"",titleIcon:""},p);if(b.g_stack===undefined){b.g_stack=[]}var n=b.g_stack;n.push({callbacks:{ready:null,validateSubmit:null,ok:[],cancel:[]},opts:l,target:a(this[0]),onTheFly:this.parent().length==0});var g={},m=n.length-1,i=n[m];var o={coverDiv:'<div id="jQueryModalForm_cover" style="position:absolute;left:0;top:0;height:'+a(document).height()+"px;width:"+a(document).width()+"px;background:"+c.coverColor+";opacity:"+c.coverOpacity+';z-index:90000;"></div>',cageDiv:'<div id="jQueryModalForm_cage_'+m+'" style="display:none;position:fixed;box-shadow:'+c.shadow+";-moz-box-shadow:"+c.shadow+";border-radius:"+c.borderRadius+";-moz-border-radius:"+c.borderRadius+";z-index:"+(90001+m*2)+';">'+(l.title!=""?'<div style="background:'+(l.titleBackground!=""?l.titleBackground:c.titleBackground)+";color:"+(l.titleColor!=""?l.titleColor:c.titleColor)+';padding:4px 6px;font-weight:bold;">'+(c.titleIcon!=""||l.titleIcon!=""?'<img src="'+(l.titleIcon!=""?l.titleIcon:c.titleIcon)+'" style="vertical-align:bottom;"/> ':"")+l.title+"</div>":"")+'<form style="margin:0;padding:5px;background:'+(l.background!=""?l.background:c.background)+';"><table><tr><td style="padding-bottom:10px;"></td></tr><tr><td style="text-align:'+(l.hasCancel?"right":"center")+"; padding-top:6px; border-top:"+(l.bottomLine!=""?l.bottomLine:c.bottomLine)+';"><input type="submit" value="'+c.labelOk+'"/> '+(l.hasCancel?'<input type="button" value="'+c.labelCancel+'"/></td></tr>':"")+"</table></form></div>"};var f=function(q){return{x:a(window).width()/2-q.width()/2,y:Math.max(a(window).height(),a(document).height())/2-q.height()/2,cx:q.width(),cy:q.height()}};var k=function(){var r=a("div#jQueryModalForm_cage_"+m),q=f(r);r.css({left:q.x,top:q.y})};var e=function(q,s){var w=n[n.length-1],v=a("div#jQueryModalForm_cage_"+(n.length-1)),u=a("div#jQueryModalForm_cover");w.target.appendTo("body").hide();if(w.onTheFly){w.target.remove()}v.remove();if(n.length==1){a("body").css({overflow:"auto"});a(document).off("keydown.jQueryModalForm");u.off("click.jQueryModalForm").remove()}else{u.css({"z-index":(90000+(n.length-2)*2)});a("div#jQueryModalForm_cage_"+(n.length-2)+" form :input:visible:first").focus()}w=n.pop();var r=w.callbacks;if(!w.opts.hasCancel||q=="ok"){for(var t=0;t<r.ok.length;++t){r.ok[t].apply(g,s)}}if(!w.opts.hasCancel||q=="cancel"){for(var t=0;t<r.cancel.length;++t){r.cancel[t].apply(g,s)}}};var d=function(q,r){var t=n[n.length-1],s=a("div#jQueryModalForm_cage_"+(n.length-1));if(t.opts.event!==null){s.animate({left:t.opts.event.clientX,top:t.opts.event.clientY,width:0,height:0},200,function(){s.css({width:"auto",height:"auto"});e(q,r)})}else{s.fadeOut(180,function(){e(q,r)})}};var h=function(){var q=a("div#jQueryModalForm_cover"),r=a("div#jQueryModalForm_cage_"+m+" form");if(m==0){a(document).on("keydown.jQueryModalForm",function(s){if(c.closeOnEsc&&s.keyCode==27){d("cancel")}if(c.disableF5&&s.which==116){s.preventDefault()}});q.on("click.jQueryModalForm",function(){if(c.closeOnOutsideClick){d("cancel")}else{r.find(":input:visible:first").focus()}})}r.submit(function(){if(i.callbacks.validateSubmit!==null){i.callbacks.validateSubmit.apply(g)}else{d("ok")}return false});r.find("input[value="+c.labelCancel+"]").click(function(){d("cancel")});r.find(":input:visible:first").focus();if(i.callbacks.ready!==null){i.callbacks.ready.apply(g)}};var j=function(){if(m==0){a("body").css({overflow:"hidden"}).append(o.coverDiv)}else{a("div#jQueryModalForm_cover").css({"z-index":(90000+m*2)})}a("body").append(o.cageDiv);var r=a("div#jQueryModalForm_cage_"+m);i.target.appendTo(r.find("form td:first")).show();var q=f(r);if(l.event!==null){r.css({left:l.event.clientX,top:l.event.clientY,width:0,height:0}).show().animate({left:q.x,top:q.y,width:q.cx,height:q.cy},200,function(){r.css({width:"auto",height:"auto"});h()})}else{r.css({left:q.x,top:q.y}).fadeIn(180,h)}};j();return a.extend(g,{ok:function(q){i.callbacks.ok.push(q);return this},cancel:function(q){i.callbacks.cancel.push(q);return this},ready:function(q){i.callbacks.ready=q;return this},abort:function(){d("cancel",arguments)},validateSubmit:function(q){i.callbacks.validateSubmit=q;return this},continueSubmit:function(){d("ok",arguments)},centerOnPage:k})}})(jQuery);